# ğŸ“ fixtures/ â€” Playwright Fixture System

## Overview

This folder is the **dependency injection layer** of the test framework. Instead of importing `@playwright/test` directly in your test files, you import from here:

```ts
// âœ… Always do this
import { test, expect } from '../fixtures';

// âŒ Never do this in spec files
import { test, expect } from '@playwright/test';
```

---

## Fixture Files

| File | What it provides | Key fixtures |
|---|---|---|
| `auth.fixture.ts` | Browser session management | `storageStatePage`, `freshLoginPage`, `authenticatedContext` |
| `api.fixture.ts` | HTTP request contexts | `apiClient`, `authedApiClient` |
| `pages.fixture.ts` | Page Object injection | `landingPage`, *(add more as you build)* |
| `network.fixture.ts` | Route interception & logging | `mockNetwork`, `blockAnalytics`, `networkLogs` |
| `data.fixture.ts` | Test data factories | `testUser`, `testProduct`, `timestamp`, `randomString` |
| `globalSetup.ts` | Pre-test auth session saver | *(runs once before all tests)* |
| `index.ts` | Merges all fixtures into one `test` | *(the single import point)* |

---

## How to Use

### 1. Basic authenticated test
```ts
import { test, expect } from '../fixtures';

test('dashboard loads', async ({ storageStatePage }) => {
  await expect(storageStatePage).toHaveURL(/dashboard/);
});
```

### 2. API + UI combined test
```ts
test('user appears in UI after API creation', async ({ authedApiClient, storageStatePage, testUser }) => {
  await authedApiClient.post('/users', { data: testUser });
  await storageStatePage.goto('/users');
  await expect(storageStatePage.getByText(testUser.name)).toBeVisible();
});
```

### 3. Mock a network error
```ts
test('shows 500 error banner', async ({ page, mockNetwork }) => {
  await mockNetwork(page, '/api/stats', 500, { error: 'Server Error' });
  await page.goto('/dashboard');
  await expect(page.getByRole('alert')).toBeVisible();
});
```

### 4. Assert an API was called
```ts
test('pay button triggers POST', async ({ storageStatePage, networkLogs }) => {
  await storageStatePage.goto('/checkout');
  await storageStatePage.getByRole('button', { name: /pay/i }).click();
  const call = networkLogs.find(r => r.url().includes('/api/payment'));
  expect(call?.method()).toBe('POST');
});
```

---

## Adding a New Page Object

1. Create `pages/YourPage/YourPage.ts`
2. Import it in `pages.fixture.ts`
3. Add fixture entry:
   ```ts
   yourPage: async ({ page }, use) => {
     await use(new YourPage(page));
   },
   ```
4. Add `yourPage` to the `PageFixtures` type
5. Done â€” available in every test automatically

---

## Directory Structure

```
automationframework-ts/
â”œâ”€â”€ .auth/
â”‚   â””â”€â”€ session.json          â† auto-generated by globalSetup (gitignored)
â”œâ”€â”€ fixtures/
â”‚   â”œâ”€â”€ index.ts              â† single import point for all tests
â”‚   â”œâ”€â”€ auth.fixture.ts
â”‚   â”œâ”€â”€ api.fixture.ts
â”‚   â”œâ”€â”€ pages.fixture.ts
â”‚   â”œâ”€â”€ network.fixture.ts
â”‚   â”œâ”€â”€ data.fixture.ts
â”‚   â””â”€â”€ globalSetup.ts
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ LandingPage/
â”‚       â””â”€â”€ LandingPage.ts
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ fixtures-usage/       â† example tests showing fixture patterns
â”‚       â”œâ”€â”€ auth.spec.ts
â”‚       â”œâ”€â”€ api.spec.ts
â”‚       â”œâ”€â”€ network.spec.ts
â”‚       â””â”€â”€ data.spec.ts
â”œâ”€â”€ playwright.config.ts
â””â”€â”€ .env
```

---

## .env Variables Required

```env
BASE_URL=http://localhost:3000
API_BASE_URL=http://localhost:3000/api
TEST_USER=admin@example.com
TEST_PASS=password123
API_TOKEN=your-api-token-here
```

---

## .gitignore Additions

```gitignore
.auth/
test-results/
playwright-report/
```
